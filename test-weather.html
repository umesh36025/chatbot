<!DOCTYPE html>
<html>
<head>
    <title>Weather API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .weather-card { 
            border: 1px solid #ccc; 
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 8px; 
            background: #f9f9f9;
        }
        .loading { color: #666; }
        .error { color: red; }
        input { padding: 10px; margin: 10px 0; width: 200px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üå§Ô∏è CropEye Weather API Test</h1>
    
    <div>
        <input type="text" id="locationInput" placeholder="Enter city name (e.g., London)" value="London">
        <button onclick="testWeather()">Get Weather</button>
    </div>
    
    <div id="result"></div>

    <script>
        async function testWeather() {
            const location = document.getElementById('locationInput').value;
            const resultDiv = document.getElementById('result');
            
            if (!location) {
                resultDiv.innerHTML = '<div class="error">Please enter a location</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">Loading weather data...</div>';
            
            try {
                const response = await fetch(`/api/weather?location=${encodeURIComponent(location)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="weather-card">
                        <h3>üåç ${data.location} ${data.country ? `(${data.country})` : ''}</h3>
                        <p><strong>Temperature:</strong> ${data.temperature}¬∞C ${data.feelsLike ? `(feels like ${data.feelsLike}¬∞C)` : ''}</p>
                        <p><strong>Condition:</strong> ${data.description || 'N/A'}</p>
                        <p><strong>Humidity:</strong> ${data.humidity}%</p>
                        <p><strong>Wind Speed:</strong> ${data.windSpeed} km/h</p>
                        <p><strong>Visibility:</strong> ${data.visibility} km</p>
                        ${data.pressure ? `<p><strong>Pressure:</strong> ${data.pressure} hPa</p>` : ''}
                        ${data.rainfall > 0 ? `<p><strong>Rainfall:</strong> ${data.rainfall} mm/h</p>` : ''}
                        <p><strong>Data Source:</strong> ${data.source === 'live' ? 'üî¥ Live Data' : 'üìä Simulated Data'}</p>
                        ${data.note ? `<p><em>${data.note}</em></p>` : ''}
                        <p><small>Updated: ${new Date(data.timestamp).toLocaleString()}</small></p>
                    </div>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                console.error('Weather API test error:', error);
            }
        }
        
        // Test on page load
        window.onload = () => testWeather();
    </script>
</body>
</html>